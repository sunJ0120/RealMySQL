## ì „ë¬¸ ê²€ìƒ‰ ì¸ë±ìŠ¤

b-tree ì¸ë±ìŠ¤ì˜ ê²½ìš°, ì¼ë¶€ë§Œì„ ì˜ë¼ì„œ ì¸ë±ìŠ¤ë¡œ ë§Œë“¤ê¸° ë•Œë¬¸ì—, ì „ë¬¸ ê²€ìƒ‰ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤. (containê°™ì€) 

ê·¸ë˜ì„œ LIKE %í‚¤ì›Œë“œ%ì™€ ê°™ì€ ê²ƒì€ ê²€ìƒ‰í•  ìˆ˜ ì—†ì—ˆë˜ ê²ƒì´ë‹¤.

ë¬¸ì„œ ì „ì²´ì— ëŒ€í•œ ë¶„ì„ê³¼ ê²€ìƒ‰ì„ ìœ„í•œ ì´ëŸ° ì¸ë±ì‹± ì•Œê³ ë¦¬ì¦˜ì„ ì „ë¬¸ ê²€ìƒ‰(Full Text search) ì¸ë±ìŠ¤ ë¼ê³  í•˜ëŠ”ë°, ì´ë¥¼ ìœ„í•´ì„œëŠ” ì „ë¬¸ ê²€ìƒ‰ì„ ìœ„í•œ ì¸ë±ìŠ¤ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

### ì¸ë±ìŠ¤ ì•Œê³ ë¦¬ì¦˜

ì „ë¬¸ ê²€ìƒ‰ì—ì„œëŠ” ë¬¸ì„œ ë³¸ë¬¸ì˜ ë‚´ìš©ì—ì„œ ì‚¬ìš©ìê°€ ê²€ìƒ‰í•˜ê²Œ ë  í‚¤ì›Œë“œë¥¼ ë¶„ì„í•´ë‚´ê³ , ë¹ ë¥¸ ê²€ìƒ‰ìš©ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì´ëŸ¬í•œ í‚¤ì›Œë“œë¡œ ì¸ë±ìŠ¤ë¥¼ êµ¬ì¶•í•œë‹¤.

ì´ëŸ¬í•œ ì „ë¬¸ ê²€ìƒ‰ ì¸ë±ìŠ¤ëŠ” ë¬¸ì„œì˜ í‚¤ì›Œë“œë¥¼ ì¸ë±ì‹±í•˜ëŠ” ê¸°ë²•ì— ë”°ë¼ í¬ê²Œ ë‹¨ì–´ì˜ ì–´ê·¼ ë¶„ì„ê³¼ n-gram ë¶„ì„ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ë‚˜ëˆ ì„œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.

### ì–´ê·¼ ë¶„ì„ ì•Œê³ ë¦¬ì¦˜

ì–´ê·¼ ë¶„ì„ ì•Œê³ ë¦¬ì¦˜ì˜ ê²½ìš°, ê²€ìƒ‰ì–´ì—ì„œ ë³„ ê°€ì¹˜ê°€ ì—†ëŠ” ë‹¨ì–´ë¥¼ ëª¨ë‘ í•„í„°ë§í•´ì„œ ì œê±°í•˜ëŠ” **ë¶ˆìš©ì–´ ì œê±°** ì‘ì—…ì„ ê±°ì¹œ í›„ ì–´ê·¼ ë¶„ì„ì„ í†µí•´ ë¿Œë¦¬ì¸ ì›í˜• ë‹¨ì–´ë¥¼ ì°¾ëŠ” ë°©ì‹ìœ¼ë¡œ ì´ë¤„ì§„ë‹¤.

ê·¸ëŸ¬ë‚˜, ì–´ê·¼ ë¶„ì„ì˜ ê²½ìš°ëŠ” ë‹¨ì–´ ì‚¬ì „ì´ í•„ìš”í•˜ê³ , í•™ìŠµì—ë„ ì‹œê°„ì´ ê±¸ë¦¬ê¸° ë•Œë¬¸ì— í•œê¸€ì— ë§ê²Œ ì™„ì„±ë„ë¥¼ ê°–ì¶”ëŠ” ê²ƒì— ë§ì€ ì‹œê°„ì„ í•„ìš”ë¡œ í•œë‹¤.

### n-gram ì•Œê³ ë¦¬ì¦˜

ê·¸ë˜ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë°”ë¡œ n-gram ì•Œê³ ë¦¬ì¦˜ì´ë‹¤.

n-gramì´ë€, ë³¸ë¬¸ì„ ë¬´ì¡°ê±´ ëª‡ ê¸€ìì”© ì˜ë¼ì„œ ì¸ë±ì‹± í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ, ì—¬ê¸°ì„œ nì€ ì¸ë±ì‹±í•  í‚¤ì›Œë“œì˜ ìµœì†Œ ê¸€ììˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤.

ê° ë‹¨ì–´ë¥¼ ë„ì–´ì“°ê¸°ë‚˜ ê³µë°±ì— ë”°ë¼ ë‚˜ëˆˆ í›„, ê·¸ ì•ˆì—ì„œ nê°œì”©ì„ í† í°ìœ¼ë¡œ ìƒì„±í•˜ì—¬ b-treeë¡œ ì—°ê²°í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬ì„±ëœë‹¤. ì´ë•Œ, nê°œì˜ í† í°ì„ ìƒì„±í• ë•ŒëŠ” ê° ê¸€ìê°€ ì¤‘ì²©ë˜ì–´ ì €ì¥ëœë‹¤ëŠ” ê²ƒì´ë‹¤.

ì„œë²„ì— ë‚´ì¥ëœ ë¶ˆìš©ì–´ ë¦¬ìŠ¤íŠ¸ëŠ” information_schema.innodb_ft_default_stopword í…Œì´ë¸”ì„ í†µí•´ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.

![ë¶ˆìš©ì–´.png](images/ë¶ˆìš©ì–´.png)

## ê·¸ëŸ¼ n-gram ì „ë¬¸ ì¸ë±ìŠ¤ëŠ” ì‹¤ì œë¡œ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ë°?

ì„¤ëª…ë§Œ ë“¤ì–´ì„œëŠ” ì „ë¬¸ ì¸ë±ìŠ¤ê°€ ì–´ë–»ê²Œ ë™ì‘ í•˜ëŠ”ì§€ í—·ê°ˆë¦´ ìˆ˜ ìˆë‹¤.

ì§ì ‘ ì˜ˆì‹œë¥¼ ì‚´í´ë³´ë©° ë™ì‘ ì›ë¦¬ë¥¼ ìµí˜€ë³´ì.

### 1. n-gram íŒŒì‹±

```
"í­êµ°ì˜ ë¸”ë¡œê±°ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤."

â†’ 2ê¸€ìì”© ìŠ¬ë¼ì´ë”©:
"í­êµ°", "êµ°ì˜", "ì˜ ", " ë¸”", "ë¸”ë¡œ", "ë¡œê±°", "ê±°ê°€", "ê°€ ", " ë˜", "ë˜ì—ˆ", "ì—ˆìŠµ", "ìŠµë‹ˆ", "ë‹ˆë‹¤", "ë‹¤."
```

### 2. ë¶ˆìš©ì–´ ì œê±°

**ë¶ˆìš©ì–´ (Stopwords):**

- ê³µë°±ì„ í¬í•¨í•œ í† í°: `"ì˜ "`, `" ë¸”"`, `"ê°€ "`, `" ë˜"`
- íŠ¹ìˆ˜ë¬¸ìë§Œ ìˆëŠ” í† í°: `"ë‹¤."`
- ì˜ë¯¸ ì—†ëŠ” ì¡°ì‚¬/ì ‘ì†ì‚¬ (ì„¤ì •ì— ë”°ë¼): `"ì˜ "`, `"ê°€ "`

```
"í­êµ°", "êµ°ì˜", "ë¸”ë¡œ", "ë¡œê±°", "ê±°ê°€", "ë˜ì—ˆ", "ì—ˆìŠµ", "ìŠµë‹ˆ", "ë‹ˆë‹¤"
```

### 3. B-Treeì— ì €ì¥

```
B-tree êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Root Node                  â”‚
â”‚    [ê±°ê°€, ë˜ì—ˆ, ë¡œê±°, ...]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚        â”‚        â”‚
    â”Œâ”€â”€â”€â”€â”˜        â”‚        â””â”€â”€â”€â”€â”
    â–¼             â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ "ê±°ê°€" â”‚    â”‚ "ë˜ì—ˆ" â”‚     â”‚ "ë¡œê±°" â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Doc:1  â”‚    â”‚Doc:1  â”‚      â”‚Doc:1  â”‚
â”‚Pos:7  â”‚    â”‚Pos:10 â”‚      â”‚Pos:5  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”˜

```

ê° í† í°ë§ˆë‹¤â€¦..

- ë¬¸ì„œ ID (ì–´ëŠ ë¬¸ì„œì— ìˆëŠ”ì§€)
- ìœ„ì¹˜ ì •ë³´ (ë¬¸ì„œ ë‚´ ëª‡ ë²ˆì§¸ ìœ„ì¹˜)ê°€ ì¡´ì¬í•œë‹¤.

### 4. â€œë¸”ë¡œê±°â€ë¥¼ ê²€ìƒ‰

```
// ì‚¬ìš©ì ì…ë ¥: "ë¸”ë¡œê±°"

// 1ë‹¨ê³„: ê²€ìƒ‰ì–´ë¥¼ n-gram íŒŒì‹±
"ë¸”ë¡œê±°" â†’ ["ë¸”ë¡œ", "ë¡œê±°", "ê±°"]  // ë¶ˆìš©ì–´ ì œê±° ì—†ì´ íŒŒì‹±

// 2ë‹¨ê³„: B-treeì—ì„œ ê° í† í° ì¡°íšŒ
ì¸ë±ìŠ¤["ë¸”ë¡œ"] â†’ {ë¬¸ì„œ1: [ìœ„ì¹˜4]}
ì¸ë±ìŠ¤["ë¡œê±°"] â†’ {ë¬¸ì„œ1: [ìœ„ì¹˜5]}
ì¸ë±ìŠ¤["ê±°"]   â†’ {ë¬¸ì„œ1: [ìœ„ì¹˜6, ìœ„ì¹˜7...]} // "ê±°ê°€"ì˜ "ê±°"ë„ í¬í•¨

// 3ë‹¨ê³„: ì—°ì†ì„± ì²´í¬
ë¬¸ì„œ1ì—ì„œ:
  - "ë¸”ë¡œ"ê°€ ìœ„ì¹˜4ì— ìˆê³ 
  - "ë¡œê±°"ê°€ ìœ„ì¹˜5ì— ìˆê³   (4+1 = 5 âœ“)
  - "ê±°"ê°€ ìœ„ì¹˜5 ë‹¤ìŒì— ìˆë‚˜? (5+1 = 6, "ê±°ê°€"ì˜ ìœ„ì¹˜ âœ“)
  
â†’ "ë¸”ë¡œê±°"ê°€ ì—°ì†ìœ¼ë¡œ ì¡´ì¬! â†’ ë¬¸ì„œ1 ë°˜í™˜
```

### 4-2. ì¶”ê°€) "ë¸”ë¡œ ë˜ì—ˆ" ê²€ìƒ‰ (ë„ì–´ì“°ê¸° í¬í•¨)

```
// NATURAL LANGUAGE MODE
"ë¸”ë¡œ ë˜ì—ˆ" â†’ ["ë¸”ë¡œ", "ë˜ì—ˆ"]  // ê³µë°± ë¬´ì‹œí•˜ê³  íŒŒì‹±

// B-tree ì¡°íšŒ
ì¸ë±ìŠ¤["ë¸”ë¡œ"] â†’ {ë¬¸ì„œ1: [ìœ„ì¹˜4]}
ì¸ë±ìŠ¤["ë˜ì—ˆ"] â†’ {ë¬¸ì„œ1: [ìœ„ì¹˜8]}

// ë‘ í† í° ëª¨ë‘ ì¡´ì¬ â†’ ê´€ë ¨ë„ ì ìˆ˜ ê³„ì‚° â†’ ë¬¸ì„œ1 ë°˜í™˜
// (ì—°ì†ì„± ì²´í¬ ì•ˆ í•¨, ë‘˜ ë‹¤ ìˆìœ¼ë©´ OK)
```

ì´ëŸ°ì‹ìœ¼ë¡œ ê²€ìƒ‰ ë˜ì–´ ë„ì–´ì“°ê¸°ê°€ í¬í•¨ëœ ê²½ìš°ë„ ê²€ìƒ‰ì´ ê°€ëŠ¥í•´ì§€ëŠ” ê²ƒì´ë‹¤.

> ğŸŒŸ ì¦‰, ì „ë¬¸ ê²€ìƒ‰ì€ ë‹¤ìŒì˜ ìˆœì„œë¡œ ì´ì–´ì§„ë‹¤.
>
> 1. ìš°ì„ , nê°œì”© í† í°ì„ íŒŒì‹±í•œë‹¤.
> 2. ê·¸ ë‹¤ìŒ ë¶ˆìš©ì–´ë¥¼ ì—†ì•¤ë‹¤.
> 3. ë¶ˆìš©ì–´ê°€ ì—†ëŠ” í† í°ì„ ë¬¸ì„œ id, ìœ„ì¹˜ ê°’ê³¼ í•¨ê»˜ b-treeì— ì €ì¥í•œë‹¤.
> 4. í‚¤ì›Œë“œê°€ ë“¤ì–´ì˜¤ë©´ í‚¤ì›Œë“œë„ nê°œì”© í† í°í™” í•œë‹¤.
> 5. í‚¤ì›Œë“œì— ë§ëŠ” ê°’ì„ b-treeì—ì„œ ì°¾ì•„ì„œ ë¬¸ì„œ ì•ˆì—ì„œ **ì—°ê²° ë˜ì–´ ìˆì–´ì„œ í‚¤ì›Œë“œê°€ ì¡´ì¬í•˜ëŠ”ì§€ë¥¼ ë³¸ë‹¤.
> 6. ë„ì–´ì“°ê¸°ê°€ ìˆì„ ê²½ìš°, ê´€ë ¨ë„ ì ìˆ˜ë¥¼ ê³„ì‚°í•´ì„œ ë”°ì§€ëŠ” ì‹ìœ¼ë¡œ ì—°ì†ì„±ì„ ì²´í¬í•˜ì§€ ì•ŠëŠ”ë‹¤.**
>

## ì‹¤ìŠµ ê²°ê³¼ 

- í‚¤ì›Œë“œ : 894

```
http://localhost:8085/api/logs/performance/full?keyword=894
```

```json
{
    "likeSearchTime": 187,
    "fullTextSearchTime": 40,
    "likeResultCount": 300,
    "fullTextResultCount": 300,
    "performanceImprovement": 78.6096256684492,
    "testDescription": "í˜„ì¬ ì „ë¬¸ ì¸ë±ìŠ¤ ìƒíƒœ",
    "keyword": "894"
}
```